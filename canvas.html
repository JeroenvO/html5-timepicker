<!DOCTYPE html>
<html>
<head>
<title>
canvas
</title>
<style>
body{
	-ms-touch-action: none;   
  	user-select: none;
	-ms-content-zooming: none;
	/*-ms-overflow-style: -ms-autohiding-scrollbar*/
}
</style>
</head>
<body>
<canvas width="400" height="400" id="timePicker">

</canvas>
<script type="text/javascript">
//*//**/
//draw some shapes that don't change over time

thisCanvas.prototype.drawTime = function(drawHandles){
	if(this.changed){
		var angle = {h : this.hAngle, m : this.mAngle};
		//clear canvas first
		this.ctx.clearRect ( 0 , 0 , 2*this.centerX , 2*this.centerY );
		//draw dark circles below the rest
		//outer
		this.ctx.beginPath();
		this.ctx.rect(0,0,2*this.centerX , 2*this.centerY);
		this.ctx.closePath();
		this.ctx.fillStyle = 'rgba(200,200,200,1)';
		this.ctx.fill();
		/*
		this.ctx.beginPath();
		this.ctx.arc(this.centerX, this.centerY, this.scale*5/4, 0, 2*Math.PI, false);
		this.ctx.closePath();
		this.ctx.fillStyle = 'rgba(240,240,240,1)';
		this.ctx.fill();
		*/
		//below minutes
		this.ctx.beginPath();
		this.ctx.arc(this.centerX, this.centerY, this.scale, 0, 2*Math.PI, false);
		this.ctx.closePath();
		this.ctx.fillStyle = 'rgba(50,50,50,1)';
		this.ctx.fill();
		//below hours
		this.ctx.beginPath();
		this.ctx.arc(this.centerX, this.centerY, this.scale*3/4, 0, 2*Math.PI, false);
		this.ctx.closePath();
		this.ctx.fillStyle = 'rgba(30,30,30,1)';
		this.ctx.fill();
		console.log(this.hSnd);
		if(this.hSnd){ //draw second round darker
			
			this.ctx.beginPath();
			this.ctx.arc(this.centerX, this.centerY, this.scale*3/4, 0, 2*Math.PI, false);
			this.ctx.closePath();
			this.ctx.fillStyle = this.hColor;
			this.ctx.fill();
		}
		//draw inside
		this.ctx.beginPath();
		this.ctx.arc(this.centerX, this.centerY, this.scale/2, 0, 2*Math.PI, false);
		this.ctx.closePath();
		this.ctx.fillStyle = 'rgba(10,10,10,1)';
		this.ctx.fill();
		//general for hours and minutes
		this.ctx.lineWidth = this.scale/4;
		//draw outer circle for minutes
		this.ctx.beginPath();
		this.ctx.strokeStyle=this.mColor;
		this.ctx.arc(this.centerX, this.centerY, this.scale*3/4+this.scale/8, -0.5*Math.PI, angle.m, false);
		this.ctx.stroke();
		this.ctx.closePath();
		//draw inner circle for hours
		//if(this.hs===12){this.ctx.globalAlpha=0.5}
		this.ctx.beginPath();
		this.ctx.strokeStyle=this.hSnd?this.hColor2:this.hColor;
		this.ctx.arc(this.centerX, this.centerY, this.scale/2+this.scale/8, -0.5*Math.PI, angle.h, false);
		this.ctx.stroke();
		this.ctx.closePath();
		//this.ctx.globalAlpha=1;
		//draw time in the center
		var fontSize = this.scale/3;
		this.ctx.font= fontSize + "px Segoe UI light";
		var text = this.getTimeStr();
		this.ctx.textAlign = 'center';
		this.ctx.fillStyle = 'white';
		this.ctx.fillText(text,this.centerX,this.centerY+this.scale/10);
		if(drawHandles){
			handlesPos = this.getHandlers();
			//minute handle
			this.ctx.beginPath();
			this.ctx.arc(handlesPos.xm, handlesPos.ym, this.scale/8-this.scale/47, 0, 2*Math.PI, false);
			this.ctx.closePath();
			this.ctx.strokeStyle='white'
			this.ctx.lineWidth = this.scale/47;
			this.ctx.stroke();
			this.ctx.fillStyle = (this.selected==='m')?'rgba(255,255,255,1)':'rgba(38,38,38,1)';
			this.ctx.fill();
			//triangle for minute
			
			//hour handle
			this.ctx.beginPath();
			this.ctx.arc(handlesPos.xh, handlesPos.yh, this.scale/8-this.scale/47, 0, 2*Math.PI, false);
			this.ctx.closePath();
			this.ctx.strokeStyle='white'
			this.ctx.lineWidth = this.scale/47;
			this.ctx.stroke();
			this.ctx.fillStyle = (this.selected==='h')?'rgba(255,255,255,1)':'rgba(38,38,38,1)';
			this.ctx.fill();
			//triangle for hour
			
		}	

	}
	this.changed = false;
}
//return the position of the mouse relative to the canvas
thisCanvas.prototype.getMousePos = function(evt) {
	var rect = this.canvas.getBoundingClientRect();
	return {
		x: evt.clientX - rect.left,
		y: evt.clientY - rect.top
	};
}

//check whether a given position (of the mouse) in xMouse and yMouse falls inside one of the handlers.
//used for checked whether handle is selected
//sets this.selected to h if hours selected and m if minutes selected.
thisCanvas.prototype.contains = function(xMouse, yMouse){
	handlersPos = this.getHandlers();
	if((Math.pow(handlersPos.xh-xMouse,2)+Math.pow(handlersPos.yh-yMouse,2))  <= this.scale/8*this.scale/8 )
		return 'h';
	if((Math.pow(handlersPos.xm-xMouse,2)+Math.pow(handlersPos.ym-yMouse,2)) <= this.scale/8*this.scale/8 )
		return 'm';
	else
		return false;
}

thisCanvas.prototype.getTimeStr = function(){
	var zero = this.time().m.toString().length==1?'0':'';
	//console.log('h: '+this.time().h+' m: '+this.time().m);
	var str = this.time().h + ':' + zero + this.time().m.toString();
	//console.log('str: '+str);
	return (str);
}
//return hour and minutes angle [0:2PI] from the [0:60] and [0:24] values
function angle(h, m){
	return {
		h : ((h%12)/12*2-0.5)*Math.PI,
		m : ((m%60)/60*2-0.5)*Math.PI,
		s : h%24>12?true:false
	};
}
//return an angle converted to time. max is the maximum value of the time, this is 24 or 60
thisCanvas.prototype.time = function(){
	var offset = this.hSnd?12:0;
	//console.log('hour offset: ' + offset);
	return {
		h : (Math.round((this.hAngle+0.5*Math.PI)/0.5235) + offset)%24,
		m : Math.round((this.mAngle+0.5*Math.PI)/0.1047)
	}
}
//returns the centers of the handles for the minutes and hours.
//Used to draw the handles and to check whether they are selected
thisCanvas.prototype.getHandlers = function(draw){
	var angle = {h: this.hAngle, m: this.mAngle};
	/*
		this.scale*0.5 outside of inner time circle
		this.scale*0.75 outside of hours oocircle
		this.scale*3/8 width of arc + diameter of handle
		*/
	var x
	return {
		xh : this.centerX+Math.cos(angle.h)*(this.scale*0.5+this.scale*3/8),
		yh : this.centerY+Math.sin(angle.h)*(this.scale*0.5+this.scale*3/8),
		xm : this.centerX+Math.cos(angle.m)*(this.scale*0.75+this.scale*3/8),
		ym : this.centerY+Math.sin(angle.m)*(this.scale*0.75+this.scale*3/8)
	};
}
//set the timePicker to a given time
thisCanvas.prototype.setTime = function(hours, minutes){
	var r = angle(hours, minutes);
	this.hAngle = r.h;
	this.mAngle = r.m;
	this.hSnd = r.s;
	this.changed = true;
	return 'time set to ' + this.getTimeStr();
}

//function object for each canvas, for each timePicker
//contains all variables for a timepicker like scale and time.
function thisCanvas(canvas){
	this.canvas = canvas;
	this.centerX = canvas.width/2;
	this.centerY = canvas.height/2;
	this.ctx = canvas.getContext('2d');
	this.scale = canvas.width/8*3; //outer radius of all circles
	//colors of arcs
	this.hColor = 'red';
	this.mColor = 'green';
	this.hColor2 = 'DarkRed';
	//this.h = 10; //24*2*Math.PI+1.5*Math.PI
	//this.m = 40; //60*2*Math.PI+1.5*Math.PI
	//this.hs = 12; //12 hour offset if time is second round h>12
	this.hAngle = 1; //hours angle
	this.mAngle = 1; //minutes angle
	this.hSnd = false;  //whether this is the second round for hours
	this.drawHandles = true;
	this.prevH = 0; //previous value for the hours handler. Used to detect secondround
	//draw time for the first time
	this.changed = true;
	this.drawTime(true); //draw handler with handles
	
	var thisCanvas = this;
	setInterval(function() { timePicker.drawTime(thisCanvas.drawHandles); }, 50);
	
	//if the mouse is down, check whether it is on any of the handles
	canvas.addEventListener('mousedown', function(e) {
		var mouse = thisCanvas.getMousePos(e);
		thisCanvas.selected = thisCanvas.contains(mouse.x,mouse.y); //this functions sets thisCanvas.selected
		thisCanvas.changed = true; //redraw to show selected handle on click, not only on draw
	});
	//if the mouse if moved AND a handler is selected, move the handler and calculate the new time
	canvas.addEventListener('mousemove', function(e) {
		if(thisCanvas.selected){
			var mouse = thisCanvas.getMousePos(e);
			var mx = mouse.x;
			var my = mouse.y;
			//calculate the rotate angle from the mouse X and Y
			var angle = Math.atan((my-thisCanvas.centerY)/(mx-thisCanvas.centerX));
			angle = (mx>=thisCanvas.centerX)?angle:angle+Math.PI;

			//set the angle right
			if(thisCanvas.selected === 'h'){ // hours selected
				thisCanvas.hAngle = angle;
				//console.log(angle);
				var p = thisCanvas.prevH;
				var a = (angle+0.5*Math.PI).toFixed(1);
				console.log('p: '+p+' a: '+a);
				if(a==0){
					if( p == 11 || p == 1 ){ // if angle zero and last movement in left half
						thisCanvas.hSnd = true; // set second
					}else if( p == 23 || p == 13){
						thisCanvas.hSnd = false;
					}else if(p==0){
						thisCanvas.hSnd = false; // set second
					}else if(p==12){
						thisCanvas.hSnd = true;
					}
				}
			}else if(thisCanvas.selected === 'm'){ //minutes selected
   				thisCanvas.mAngle = angle;
			}
			//store angle to compare later
			thisCanvas.prevH = thisCanvas.time().h; 
			//the canvas changed, if this is true, it will be redrawn
			thisCanvas.changed = true;
		}
	});
	//stop the selection when the mouse is released.
	window.addEventListener('mouseup', function(e) {
		var r = thisCanvas.time();
		thisCanvas.setTime(r.h, r.m);
		thisCanvas.selected = false;
		thisCanvas.changed = true;
	});
}

//make a canvas object
timePicker = new thisCanvas(document.getElementById('timePicker'));
timePicker.setTime(10,50);
</script>
<a href="https://github.com/JeroenvO/html5-timepicker">github code</a>
</body>
</html>